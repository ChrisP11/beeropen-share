{% extends "base.html" %}
{% load static %}

{% block title %}Event Management · Beer Open{% endblock %}

{% block content %}
<div class="container my-4">
  <h1 class="mb-3">Event Management</h1>

  <!-- Current EventSettings -->
  <div class="card mb-4">
    <div class="card-header">Current Settings</div>
    <div class="card-body">
      <div><strong>Name:</strong> {{ settings.event_name }}</div>
      <div><strong>Event date:</strong> {{ settings.event_date }}</div>
      <div><strong>Course:</strong> {{ settings.scoring_course|default:"—" }}</div>
      <div><strong>Tee:</strong> {{ settings.scoring_tee|default:"—" }}</div>
      <div><strong>Leaderboard public:</strong> {{ settings.leaderboard_public|yesno:"Yes,No" }}</div>
      <a href="{% url 'event_setup' %}" class="btn btn-primary mt-3">
        Kick off a new event
      </a>
    </div>
  </div>

  <!-- Active / recent event dates -->
  <div class="card">
    <div class="card-header">Event Dates</div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table mb-0 align-middle">
          <thead class="table-light">
            <tr>
              <th>Date</th>
              <th class="text-center">Total Rounds</th>
              <th class="text-center">Open Rounds</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for row in dates %}
              <tr>
                <td>{{ row.event_date }}</td>
                <td class="text-center">{{ row.total_rounds }}</td>
                <td class="text-center">
                  {% if row.open_rounds > 0 %}
                    <span class="badge bg-warning text-dark">{{ row.open_rounds }}</span>
                  {% else %}
                    <span class="badge bg-success">0</span>
                  {% endif %}
                </td>
                <td class="text-end">
                  {% if row.open_rounds > 0 %}
                    <form method="post" class="d-inline">
                      {% csrf_token %}
                      <input type="hidden" name="action" value="close">
                      <input type="hidden" name="event_date" value="{{ row.event_date|date:'Y-m-d' }}">
                      <button class="btn btn-sm btn-outline-danger"
                              onclick="return confirm('Finalize all open rounds for {{ row.event_date }}?');">
                        Close Event
                      </button>
                    </form>
                  {% else %}
                    <span class="text-muted small">Closed</span>
                  {% endif %}
                </td>
              </tr>
            {% empty %}
              <tr><td colspan="4" class="text-center text-muted py-4">No rounds yet.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>
{% endblock %}
